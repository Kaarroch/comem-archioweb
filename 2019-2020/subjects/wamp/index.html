<!DOCTYPE html>
<html>
  <head>
    <title>Web Application Messaging Protocol (WAMP) (Media Engineering Web-Oriented Architecture)</title>
    <meta charset='utf-8'>
    <meta name='config' content='{&quot;basePath&quot;:&quot;../..&quot;,&quot;remark&quot;:{&quot;highlightLines&quot;:true,&quot;highlightSpans&quot;:true,&quot;countIncrementalSlides&quot;:false},&quot;subjectUrl&quot;:&quot;https://github.com/MediaComem/comem-archioweb/tree/babf73d65dc3b0bc1f1f8cea3f76ece46e1f03ba/subjects/wamp/README.md&quot;}'>
  </head>
  <body>
    <textarea id='source'>
# Web Application Messaging Protocol (WAMP)

[WAMP][wamp] is a routed protocol that provides two messaging patterns: [Publish
& Subscribe][pubsub] and routed [Remote Procedure Calls][rpc]. It is intended to
connect application components in distributed applications.

**You will need**

* Something

**Recommended reading**

* [WebSockets](../ws/)





---
class: center, middle
## What is WAMP?

.breadcrumbs[<a href="#1">Web Application Messaging Protocol (WAMP)</a>]



<img src='images/crossbar-architecture.png' class='w70' />

---
### A messaging protocol on top of WebSockets

.breadcrumbs[<a href="#1">Web Application Messaging Protocol (WAMP)</a> > <a href="#2">What is WAMP?</a>]

WAMP is a **high-level messaging protocol for distributed applications**. It was
originally defined as a [subprotocol of WebSocket][ws-subprotocol].

In its current specification, it uses WebSocket as its default transport, but
can be **transmitted via any other protocol that allows for ordered, reliable,
bi-directional, and message-oriented communications**.

---
### Routed protocol

.breadcrumbs[<a href="#1">Web Application Messaging Protocol (WAMP)</a> > <a href="#2">What is WAMP?</a>]

WAMP is a **routed protocol**, with all components connecting to a WAMP
**router**, which performs message routing between the components.

<p class='center'><img src='images/routed-protocol.png' class='w60' /></p>

---
### Two messaging patterns

.breadcrumbs[<a href="#1">Web Application Messaging Protocol (WAMP)</a> > <a href="#2">What is WAMP?</a>]

WAMP provides two messaging patterns:

.grid-50[

**Publish & Subscribe (PubSub)**

[Publish & Subscribe][pubsub] is a messaging pattern where messages are
published to topics that other components may subscribe to. The decouples
publishers from subscribers, as they do not require prior knowledge of each
other.

<img src='images/pubsub.png' class='w100' />


]
.grid-50[

**Remote Procedure Calls (RPC)**

A [Remote Procedure Call][rpc] is when a computer program causes a procedure to
execute on another computer on a shared network, without the programmer
explicitly coding the details of the remote interaction.

<img src='images/rpc.jpg' class='w100' />




]
---
class: center, middle
## Unified application routing

.breadcrumbs[<a href="#1">Web Application Messaging Protocol (WAMP)</a>]



<img src='images/router.jpg' class='w40' />

---
### The client-server world

.breadcrumbs[<a href="#1">Web Application Messaging Protocol (WAMP)</a> > <a href="#6">Unified application routing</a>]

In the client-server model, a call goes directly from the Caller (client) to the
Callee (server), whether it's an HTTP request or a remote procedure call:

<p class='center'><img src='images/client-server.png' class='w50' /></p>

**The Caller needs to know where the Callee resides and how to reach it**. This
introduces a **strong [coupling][coupling]** between Caller and Callee, which
can cause problems because it tends to make applications complex and
unmaintainable.

---
### Publish & Subscribe

.breadcrumbs[<a href="#1">Web Application Messaging Protocol (WAMP)</a> > <a href="#6">Unified application routing</a>]

.grid-50[

In the [Publish & Subscribe (PuSub)][pubsub] model, a **Publisher** submits
messages to an abstract **topic**, and **Subscribers** only receive messages
indirectly by announcing their interest on a respective topic:


]
.grid-50[

<img src='images/pubsub.png' class='w100' />


]
.container[

.grid-50[

Both do not know about each other. They are **decoupled** via the topic and an
intermediary usually called **Broker**:


]
.grid-50[

<img src='images/wamp-pubsub.png' class='w100' />


]

]
---
#### PubSub with WAMP

.breadcrumbs[<a href="#1">Web Application Messaging Protocol (WAMP)</a> > <a href="#6">Unified application routing</a> > <a href="#8">Publish & Subscribe</a>]

With WAMP, **Subscribers** must first ask the Broker to subscribe to a topic
(step 1). The **Broker** keeps a book of subscriptions: who is currently
subscribed on which topic. WAMP is now ready to route PubSub messages.

<p class='center'><img src='images/wamp-pubsub-detailed.png' class='w90' /></p>

When a **Publisher** publishes a message to a topic (step 2), the Broker will
determine the set of Subscribers to that topic, and then forward the message to
all those Subscribers (step 3).

---
### Remote Procedure Calls

.breadcrumbs[<a href="#1">Web Application Messaging Protocol (WAMP)</a> > <a href="#6">Unified application routing</a>]

.grid-50[

[Remote Procedure Calls (RPCs)][rpc] can also be decoupled by introducing an
intermediary, the **Dealer**.

The **Dealer** routes calls originating from the **Caller** to the **Callee**
and routes back results or errors. Both do not know about each other; this
knowledge is encapsulated in the Dealer.


]
.grid-50[

<img src='images/wamp-rpc.png' class='w100' />


]
---
#### Routed RPC with WAMP

.breadcrumbs[<a href="#1">Web Application Messaging Protocol (WAMP)</a> > <a href="#6">Unified application routing</a> > <a href="#10">Remote Procedure Calls</a>]

With WAMP, a **Callee** must register a procedure at a Dealer (step 1) under an
abstract name: an URI identifying the procedure.

The **Dealer** keeps a book of registered procedures: who to call for each URI.
Once procedures have been registered, WAMP is ready to route RPC calls.

<p class='center'><img src='images/wamp-rpc-detailed.png' class='w90' /></p>

To call a remote procedure, the **Caller** talks to the Dealer and provides the
URI of the procedure. The Dealer will look up the procedure in his book of
registered procedures and contact the correct Callee to execute the procedure
(step 2). When the Caller is done, the Dealer will retrieve the result and send
it back to the Caller (step 3).

---
### The WAMP router

.breadcrumbs[<a href="#1">Web Application Messaging Protocol (WAMP)</a> > <a href="#6">Unified application routing</a>]

What if you combine a **Broker** (for Publish & Subscribe) and a **Dealer** (for
routed Remote Procedure Calls)? You get what WAMP calls a **Router**:

<p class='center'><img src='images/wamp-router.png' class='w50' /></p>

A Router is capable of routing both calls and events, and hence can support
flexible, decoupled architectures that use both RPC and PubSub.

---
### A WAMP example

.breadcrumbs[<a href="#1">Web Application Messaging Protocol (WAMP)</a> > <a href="#6">Unified application routing</a>]

Imagine you have a small embedded device like an Arduino Yun with a temperature
sensor and an actuator like a light connected. And you want to integrate the
device into an overall system with a user-facing frontend to control the light,
and continuously process sensor values in a backend component:

<p class='center'><img src='images/wamp-architecture.png' class='w70' /></p>

---
### Decoupled architecture

.breadcrumbs[<a href="#1">Web Application Messaging Protocol (WAMP)</a> > <a href="#6">Unified application routing</a>]

WAMP decouples your components because Callers are no longer required to have
knowledge of Callees. There is no longer a need for a direct network connection
or path between them, since all messages are routed by WAMP.

* Calling into procedures in **components which are not reachable from outside**
  at the network level, but which can establish an outgoing network connection
  to the WAMP router.
* This decoupling of transport and application layer traffic allows a **reversal
  of command** where a cloud-based system can securely control remote devices.
* It also allows to **treat client and server or frontend and backend components
  (microservices) the same**, and it even allows to develop backend code in the
  browser ([Free Your Code - Backends in the Browser][free-your-code]).
* Since no ports on edge devices need to be opened for WAMP to work (in both
  directions), **the remote [attack surface][attack-surface] of these devices is
  completely closed** ([Security in the IoT][iot-security]).
* Finally, since the Caller is not aware where, or even who is processing the
  call (and it should not care!), it is easy to make **highly available
  components** (using hot standby components) or **scale horizontally**
  ([Scaling microservices with Crossbar.io][scaling-microservices]).

---
### Microservices architecture

.breadcrumbs[<a href="#1">Web Application Messaging Protocol (WAMP)</a> > <a href="#6">Unified application routing</a>]

WAMP is one technology that can help you create a [microservices][microservices]
architecture, where your business logic is split across multiple components that
are independently developed and deployed:

<p class='center'><img src='images/microservices.png' class='w70' /></p>

> The WAMP router would function as the API gateway in this example.

---
### TODO

.breadcrumbs[<a href="#1">Web Application Messaging Protocol (WAMP)</a> > <a href="#6">Unified application routing</a>]

* Shared registration
* Horizontal scaling



---
## Implementations

.breadcrumbs[<a href="#1">Web Application Messaging Protocol (WAMP)</a>]

---
### TODO

.breadcrumbs[<a href="#1">Web Application Messaging Protocol (WAMP)</a> > <a href="#17">Implementations</a>]

* Crossbar.io
* Official & other clients



---
class: center, middle
## Security

.breadcrumbs[<a href="#1">Web Application Messaging Protocol (WAMP)</a>]



<img src='images/security.png' class='w30' />

---
### WAMP realms and sessions

.breadcrumbs[<a href="#1">Web Application Messaging Protocol (WAMP)</a> > <a href="#19">Security</a>]

When a WAMP Client (a Caller, Callee, Subscriber or Publisher) connects to a
WAMP Router, it must establish a session in a particular **Realm**.

<p class='center'><img src='images/wamp-security.png' class='w80' /></p>

A **Realm** is a WAMP routing and administrative domain, **optionally protected
by authentication and authorization**. WAMP messages are only routed within a
Realm.

---
### TODO

.breadcrumbs[<a href="#1">Web Application Messaging Protocol (WAMP)</a> > <a href="#19">Security</a>]

* Authentication
* https://crossbar.io/docs/Authorization/



---
## To WAMP or not to WAMP?

.breadcrumbs[<a href="#1">Web Application Messaging Protocol (WAMP)</a>]

[WAMP compared][wamp-compared] to other technologies.

.grid-50[

**Advantages**

* The protocol combines two patterns (PubSub & RPC), allowing it to be **used
  for the entire messaging requirements of an application**, reducing technology
  stack complexity.
* The use of WebSocket as a transport mechanism by default **reduces networking
  overhead**.


]
.grid-50[

**Disadvantages**

* **Not (yet) an official standard**. No higher level software architectural
  styles like REST (for now).
* Requires you to **deploy an additional component**: the WAMP router.
* Decoupled microservices are **more complex** than classic client-server
  architectures.


]
---
## Roles

.breadcrumbs[<a href="#1">Web Application Messaging Protocol (WAMP)</a>]

* Session: established over a Connection, joined to a Realm on a Router



---
## References

.breadcrumbs[<a href="#1">Web Application Messaging Protocol (WAMP)</a>]

**Documentation**

* [The Web Application Messaging Protocol][wamp]
* [WAMP Specification][wamp-spec]
* [What is Crossbar.io?][crossbar]

**Further reading**

* [Microservices implementation - Netflix stack](https://medium.com/@tharanganilupul/microservices-implementation-netflix-stack-ba4f4a57a79f)
* [Why Netflix, Amazon and Apple Care About Microservices](https://blog.leanix.net/en/why-netflix-amazon-and-apple-care-about-microservices)



---
## TODO

.breadcrumbs[<a href="#1">Web Application Messaging Protocol (WAMP)</a>]

* JSON / MessagePack



[attack-surface]: https://en.wikipedia.org/wiki/Attack_surface
[crossbar]: https://crossbar.io/about/
[coupling]: https://en.wikipedia.org/wiki/Coupling_(computer_programming)
[free-your-code]: https://crossbario.com/blog/Free-Your-Code-Backends-in-the-Browser/
[iot-security]: https://crossbario.com/static/presentations/iot-security/index.html#/
[microservices]: https://en.wikipedia.org/wiki/Microservices
[pubsub]: https://en.wikipedia.org/wiki/Publish%E2%80%93subscribe_pattern
[rpc]: https://en.wikipedia.org/wiki/Remote_procedure_call
[scaling-microservices]: https://crossbario.com/static/presentations/microservices/index.html#/
[wamp]: https://wamp-proto.org
[wamp-compared]: https://wamp-proto.org/comparison.html
[wamp-spec]: https://wamp-proto.org/_static/gen/wamp_latest.html
[ws-subprotocol]: https://tools.ietf.org/html/rfc6455#section-1.9
    </textarea>
    <script src='https://embed.runkit.com'></script>
    <script src='../../subject-6febf8e6a6534a4429e8.js'></script>
  </body>
</html>
